name: Build WhatsApp Bot

on:
  push:
    branches:
      - main  # or your default branch

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: ğŸ“‚ Configure Git for Private GitHub Dependency
        run: |
          git config --global url."https://github.com/".insteadOf git@github.com:

      - name: ğŸ“¦ Install Dependencies (including GitHub repo package)
        run: npm install || true

      - name: ğŸ§© Install Puppeteer Dependencies (conditionally)
        if: always()
        run: |
          if grep -q puppeteer package.json; then
            echo "ğŸ§© Puppeteer detected. Installing system dependencies..."
            sudo apt-get update && sudo apt-get install -y \
              gconf-service \
              libasound2 \
              libatk1.0-0 \
              libc6 \
              libcairo2 \
              libcups2 \
              libdbus-1-3 \
              libexpat1 \
              libfontconfig1 \
              libgcc1 \
              libgconf-2-4 \
              libgdk-pixbuf2.0-0 \
              libglib2.0-0 \
              libgtk-3-0 \
              libnspr4 \
              libpango-1.0-0 \
              libpangocairo-1.0-0 \
              libstdc++6 \
              libx11-6 \
              libx11-xcb1 \
              libxcb1 \
              libxcomposite1 \
              libxcursor1 \
              libxdamage1 \
              libxext6 \
              libxfixes3 \
              libxi6 \
              libxrandr2 \
              libxrender1 \
              libxss1 \
              libxtst6 \
              ca-certificates \
              fonts-liberation \
              libappindicator1 \
              libnss3 \
              lsb-release \
              xdg-utils \
              wget
          else
            echo "ğŸ§© Puppeteer not detected. Skipping system dependencies."
          fi
        continue-on-error: true

      - name: ğŸ”¥ Ensure Firebase is Installed
        if: always()
        run: |
          echo "ğŸ” Checking Firebase tools..."
          npm install firebase || true

      - name: âœ… Confirm Build Ready
        if: always()
        run: echo "ğŸš€ WhatsApp Bot dependencies installed and build ready."